<h2>ショッピングカート</h2>
<div>
	<% if @cart_items.blank? %>
		<h3>カート内に商品がありません。</h3>
	<% else %>
		<!-- each文をform_tagで囲って数量の一括更新を実装 -->
		<%= form_tag cart_update_path, method: :put do %>
		<!-- 引数を渡さずにupdateアクションを呼び出すため、別でルーティングを設定 -->
			<% @cart_items.each do |cart_item|%>
				<%= link_to product_path(cart_item.product_id) do %>
					<%= attachment_image_tag cart_item.product, :product_image, fallback: "no_image.jpg", size: "100x100" %>
				<% end %>
				<%= link_to cart_item.product.product_name, product_path(cart_item.product_id)%>
				<%= (cart_item.product.price*1.1).floor %>円（税込み）
				<%= cart_item.product_amount %>枚
			    <%= fields_for "cart_items[]", cart_item do |fi| %>
					<%= fi.select :product_amount, 1..cart_item.product.stock_amount %>
					<!-- プルダウンには１〜在庫数までを表示 -->
		    	<% end %>
				<%= link_to "削除", cart_path(cart_item.id), method: :delete, data:{ confirm: '本当に消しますか？' } %>
			<% end %>
			<%= submit_tag "数量を更新" %>
		<% end %>
	<% end %>

	<%= link_to "もっと買い物をする", products_path%>
</div>